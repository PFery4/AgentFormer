# ------------------- General Options -------------------------

description                  : AgentFormer (Before DLow)
results_root_dir             : results
seed                         : 1
dataset                      : sdd
sdd_config_file_name         : config
sdd_occlusion_data           : true
# data_root_ethucy             : datasets/eth_ucy
# data_root_nuscenes_pred      : datasets/nuscenes_pred

# ------------------- Feature Extractor -------------------------

past_frames                  : 8
future_frames                : 12
min_past_frames              : 8
min_future_frames            : 12

traj_scale                   : 1    # TODO: figure out correct value
motion_dim                   : 2
forecast_dim                 : 2

# ------------------- Model -------------------------

model_id: agentformer
#tf_version: v2   # TODO: remove once obvious it has no impact
tf_model_dim: 256
tf_ff_dim: 512
tf_nhead: 8
tf_dropout: 0.1
input_type: ['scene_norm', 'vel']
pred_type: 'scene_norm'
sn_out_type: 'norm'
max_train_agent: 32
pos_concat: true
rand_rot_scene: true
scene_orig_all_past: true

# TODO: properly parameterize the global map processing unit
use_global_map: true
global_map_encoder:
  model_id: global_map_cnn
  normalize: false
  dropout: 0.0
  map_channels: 3
  use_occlusion_map: true
  global_map_resolution: [400, 400]
  output_dim: 256
  layers:
    - [conv2d, 4, 7, 3]     # [out_channels, kernel_size, stride]   (in_channels=None, padding=None, padding_mode=None, dilation=None, groups=None, bias=None)
    - [maxpool, 2, 2]       # [kernel_size, stride]                 (padding=None, dilation=None, return_indices=None, ceil_mode=None)
    - [conv2d, 8, 5, 2]
    - [maxpool, 2, 2]
    - [conv2d, 8, 3, 1]
    - [maxpool, 2, 2]

context_encoder:
  nlayer: 2

future_decoder:
  nlayer: 2
  out_mlp_dim: [512, 256]

future_encoder:
  nlayer: 2
  out_mlp_dim: [512, 256]

# ------------------- VAE-------------------------

nz                           : 32
sample_k                     : 20
learn_prior                  : true

# ------------------- Training Parameters -------------------------

lr                           : 1.e-4
loss_cfg:
  mse:
    weight: 1.0
  kld:
    weight: 1.0
    min_clip: 2.0
  sample:
    weight: 1.0
    k: 20

num_epochs                   : 100
lr_fix_epochs                : 10
lr_scheduler: 'step'
decay_step: 10
decay_gamma: 0.5
print_freq                   : 20
model_save_freq              : 10

